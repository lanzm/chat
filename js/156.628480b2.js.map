{"version":3,"file":"js/156.628480b2.js","mappings":"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","sources":["webpack://my-chat/./src/views/chat/index.vue?690c","webpack://my-chat/src/views/chat/index.vue","webpack://my-chat/./src/views/chat/index.vue?74a6","webpack://my-chat/./src/views/chat/index.vue"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[_c('div',[_c('el-card',{attrs:{\"body-style\":{ padding: '10px' }}},[_c('div',{staticStyle:{\"text-align\":\"right\"}},[_c('el-dropdown',[_c('span',{staticClass:\"el-dropdown-link\",staticStyle:{\"cursor\":\"pointer\"}},[_c('el-avatar',{attrs:{\"size\":18,\"src\":_vm.user}}),_vm._v(\" ???（gpt-3.5-turbo） \"),_c('i',{staticClass:\"el-icon-arrow-down el-icon--right\"})],1),_c('el-dropdown-menu',{attrs:{\"slot\":\"dropdown\"},slot:\"dropdown\"},[_c('el-dropdown-item',{nativeOn:{\"click\":function($event){return _vm.handle2Theme.apply(null, arguments)}}},[_c('i',{staticClass:\"el-icon-sunrise-1\"}),_vm._v(\" 主题 \")]),_c('el-dropdown-item',{staticStyle:{\"color\":\"red\"},nativeOn:{\"click\":function($event){return _vm.handleLogOut.apply(null, arguments)}}},[_c('i',{staticClass:\"el-icon-switch-button\"}),_vm._v(\" 退出 \")])],1)],1)],1)])],1),(_vm.chatDataList && _vm.chatDataList.length > 0)?_c('div',[_c('div',{ref:\"chatRef\",style:({ height: _vm.height + 'px', overflowY: 'auto' })},_vm._l((_vm.chatDataList),function(item,index){return _c('div',{key:index},[(index % 2 === 0)?_c('div',{staticClass:\"my_chat\"},[_c('el-avatar',{attrs:{\"size\":32,\"src\":_vm.user}}),_c('span',{staticStyle:{\"margin-left\":\"20px\",\"width\":\"50%\"}},[_vm._v(\" \"+_vm._s(item.content)+\" \")])],1):_c('div',{staticClass:\"ai_chat\"},[_c('el-avatar',{attrs:{\"size\":32,\"src\":_vm.chatGpt}}),_c('span',{staticStyle:{\"margin-left\":\"20px\",\"width\":\"50%\"}},[_c('v-md-preview',{attrs:{\"text\":item.content}})],1)],1)])}),0)]):_c('div',{staticStyle:{\"margin-top\":\"50px\"}},[_c('el-empty',{attrs:{\"description\":\"暂无对话\"}})],1),_c('div',{staticClass:\"send-card\"},[_c('el-card',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],attrs:{\"body-style\":{ padding: '0px' },\"shadow\":\"hover\"}},[_c('el-input',{staticClass:\"chat-input\",attrs:{\"autosize\":\"\",\"maxlength\":\"100\",\"placeholder\":\"请输入你的问题\"},model:{value:(_vm.content),callback:function ($$v) {_vm.content=$$v},expression:\"content\"}},[_c('i',{staticClass:\"el-icon-s-promotion el-input__icon\",attrs:{\"slot\":\"suffix\"},on:{\"click\":_vm.handleSend},slot:\"suffix\"})])],1)],1)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <div>\n      <el-card :body-style=\"{ padding: '10px' }\">\n        <div style=\"text-align: right\">\n          <el-dropdown>\n            <span class=\"el-dropdown-link\" style=\"cursor: pointer\">\n              <el-avatar :size=\"18\" :src=\"user\"></el-avatar>\n              ???（gpt-3.5-turbo）\n              <i class=\"el-icon-arrow-down el-icon--right\"></i>\n            </span>\n            <el-dropdown-menu slot=\"dropdown\">\n              <el-dropdown-item @click.native=\"handle2Theme\">\n                <i class=\"el-icon-sunrise-1\"></i>\n                主题\n              </el-dropdown-item>\n              <el-dropdown-item @click.native=\"handleLogOut\" style=\"color: red\">\n                <i class=\"el-icon-switch-button\"></i>\n                退出\n              </el-dropdown-item>\n            </el-dropdown-menu>\n          </el-dropdown>\n        </div>\n      </el-card>\n    </div>\n    <div v-if=\"chatDataList && chatDataList.length > 0\">\n      <div ref=\"chatRef\" :style=\"{ height: height + 'px', overflowY: 'auto' }\">\n        <div v-for=\"(item, index) in chatDataList\" :key=\"index\">\n          <div v-if=\"index % 2 === 0\" class=\"my_chat\">\n            <el-avatar :size=\"32\" :src=\"user\"></el-avatar>\n            <span style=\"margin-left: 20px; width: 50%\">\n              {{ item.content }}\n            </span>\n          </div>\n          <div v-else class=\"ai_chat\">\n            <el-avatar :size=\"32\" :src=\"chatGpt\"></el-avatar>\n            <span style=\"margin-left: 20px; width: 50%\">\n              <v-md-preview :text=\"item.content\"></v-md-preview>\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div style=\"margin-top: 50px\" v-else>\n      <el-empty description=\"暂无对话\"></el-empty>\n    </div>\n    <div class=\"send-card\">\n      <el-card\n        :body-style=\"{ padding: '0px' }\"\n        v-loading=\"loading\"\n        shadow=\"hover\"\n      >\n        <el-input\n          class=\"chat-input\"\n          autosize\n          maxlength=\"100\"\n          v-model=\"content\"\n          placeholder=\"请输入你的问题\"\n        >\n          <i\n            class=\"el-icon-s-promotion el-input__icon\"\n            slot=\"suffix\"\n            @click=\"handleSend\"\n          >\n          </i>\n        </el-input>\n      </el-card>\n    </div>\n  </div>\n</template>\n\n<script>\nimport chatGpt from \"@/assets/images/chatgpt.png\";\nimport user from \"@/assets/images/user.png\";\n\nexport default {\n  components: {},\n  name: \"chatIndex\",\n  data() {\n    return {\n      loading: false,\n      height: window.innerHeight - 180,\n      theme: \"light\",\n      content: \"\",\n      contentPre: \"\",\n      chatDataList: [],\n      chatGpt: chatGpt,\n      user: user,\n      url: \"https://api.chatanywhere.com.cn/v1/chat/completions\",\n      apiKey: \"sk-Cg8AqAWoQxhqetjTXfdzOeDm5yKu3zUPdmAg9bweMkxIDskj\",\n    };\n  },\n  created() {\n    this.chatDataList = [];\n  },\n  mounted() {\n    document.addEventListener(\"keyup\", this.enterKeyDown);\n  },\n  destroyed() {\n    document.removeEventListener(\"keyup\", this.enterKeyDown);\n  },\n  methods: {\n    enterKeyDown(event) {\n      if (event.keyCode === 13) {\n        this.handleSend();\n      }\n      if (event.keyCode === 38) {\n        this.content = this.contentPre;\n      }\n    },\n    reachBottom() {\n      const _chatRef = this.$refs.chatRef;\n      if (_chatRef) {\n        setTimeout(() => {\n          _chatRef.scrollTop = _chatRef.scrollHeight;\n        }, 0);\n      }\n    },\n    handle2Theme(theme) {\n      this.theme = theme;\n    },\n    handleLogOut() {\n      localStorage.removeItem(\"username\");\n      this.$router.push({ path: \"/\" });\n    },\n    async handleSend() {\n      this.loading = true;\n      if (!this.content) {\n        this.$message({\n          message: \"消息不能为空\",\n          type: \"warning\",\n        });\n        this.loading = false;\n        return;\n      }\n      // 填充我的信息\n      const _my = {\n        role: \"user\",\n        content: this.content,\n      };\n      this.chatDataList.push(_my);\n      this.reachBottom();\n      // 请求ai\n      const _params = {\n        model: \"gpt-3.5-turbo\",\n        messages: this.chatDataList.slice(-6),\n        stream: true, // 流式\n      };\n      const self = this;\n      const res = await fetch(this.url, {\n        method: \"POST\",\n        headers: {\n          Authorization: \"Bearer \" + this.apiKey,\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(_params),\n      });\n      const reader = res.body.pipeThrough(new TextDecoderStream()).getReader();\n      let flag = true;\n      do {\n        let { value, done } = await reader.read();\n        if (done) {\n          flag = false;\n        }\n        if (!value) {\n          continue;\n        }\n        const _contentList = value.split(\"data:\");\n        if (_contentList && _contentList.length > 0) {\n          _contentList.forEach((item) => {\n            if (item && !item.includes(\"[DONE]\")) {\n              let _content = \"\";\n              if (item === \"\\n\\n\" || item === \"\\n\") {\n                _content = \"\";\n              } else {\n                const _contentObj = JSON.parse(item.trim());\n                if (_contentObj.choices && _contentObj.choices.length > 0) {\n                  if (_contentObj.choices[0].delta.content) {\n                    _content = _contentObj.choices[0].delta.content;\n                  }\n                }\n              }\n              const _lastContent =\n                self.chatDataList[self.chatDataList.length - 1];\n              if (_lastContent.role === \"assistant\") {\n                self.chatDataList[self.chatDataList.length - 1].content =\n                  _lastContent.content + _content;\n              } else {\n                const _ai = {\n                  role: \"assistant\",\n                  content: _content,\n                };\n                self.chatDataList.push(_ai);\n              }\n              self.reachBottom();\n            }\n          });\n        }\n      } while (flag);\n      self.contentPre = self.content;\n      self.content = \"\";\n      self.loading = false;\n    },\n  },\n};\n</script>\n\n<style scoped>\n.my_chat {\n  padding-top: 15px;\n  padding-bottom: 15px;\n  display: flex;\n  justify-content: center;\n  align-items: baseline;\n  //color: var(--font-color);\n}\n.ai_chat {\n  padding-top: 15px;\n  padding-bottom: 15px;\n  display: flex;\n  justify-content: center;\n  align-items: baseline;\n  //background-color: var(--ai-chat-color);\n  //color: var(--font-color);\n  background-color: #f5f5f5;\n}\n.option {\n  position: absolute;\n  bottom: 5%;\n  left: 3%;\n  text-align: left;\n}\n.send-card {\n  width: 40%;\n  position: absolute;\n  bottom: 5%;\n  left: 30%;\n}\n.send-card /deep/ .el-input__inner {\n  height: 50px !important;\n  font-size: large;\n}\n.send-card /deep/ .el-input__suffix {\n  font-size: xx-large;\n  margin-top: 4px;\n  margin-right: 10px;\n}\n</style>\n","import mod from \"-!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=99296b76&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=99296b76&prod&scoped=true&lang=css\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"99296b76\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","attrs","padding","staticStyle","staticClass","user","_v","slot","nativeOn","$event","handle2Theme","apply","arguments","handleLogOut","chatDataList","length","ref","style","height","overflowY","_l","item","index","key","_s","content","chatGpt","directives","name","rawName","value","expression","model","callback","$$v","on","handleSend","staticRenderFns","components","data","loading","window","innerHeight","theme","contentPre","url","apiKey","created","mounted","document","addEventListener","enterKeyDown","destroyed","removeEventListener","methods","event","keyCode","reachBottom","_chatRef","$refs","chatRef","setTimeout","scrollTop","scrollHeight","localStorage","removeItem","$router","push","path","$message","message","type","_my","role","_params","messages","slice","stream","self","res","fetch","method","headers","Authorization","body","JSON","stringify","reader","pipeThrough","TextDecoderStream","getReader","flag","done","read","_contentList","split","forEach","includes","_content","_contentObj","parse","trim","choices","delta","_lastContent","_ai","component"],"sourceRoot":""}