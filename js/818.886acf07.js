"use strict";(self["webpackChunkmy_chat"]=self["webpackChunkmy_chat"]||[]).push([[818],{5754:function(t,e,a){a.r(e),a.d(e,{default:function(){return d}});var n=function(){var t=this,e=t._self._c;return e("div",[e("div",[e("el-card",{attrs:{"body-style":{padding:"10px"}}},[e("div",{staticStyle:{"text-align":"right"}},[e("el-dropdown",[e("span",{staticClass:"el-dropdown-link"},[e("el-avatar",{attrs:{size:18,src:t.user}}),t._v(" ???（gpt-3.5-turbo） "),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})],1),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{nativeOn:{click:function(e){return t.handle2Theme.apply(null,arguments)}}},[e("i",{staticClass:"el-icon-sunrise-1"}),t._v(" 主题 ")]),e("el-dropdown-item",{staticStyle:{color:"red"},nativeOn:{click:function(e){return t.handleLogOut.apply(null,arguments)}}},[e("i",{staticClass:"el-icon-switch-button"}),t._v(" 退出 ")])],1)],1)],1)])],1),t.chatDataList&&t.chatDataList.length>0?e("div",[e("div",{ref:"chatRef",style:{height:t.height+"px",overflowY:"auto"}},t._l(t.chatDataList,(function(a,n){return e("div",{key:n},[n%2===0?e("div",{staticClass:"my_chat"},[e("el-avatar",{attrs:{size:32,src:t.user}}),e("span",{staticStyle:{"margin-left":"20px",width:"50%"}},[t._v(" "+t._s(a.content)+" ")])],1):e("div",{staticClass:"ai_chat"},[e("el-avatar",{attrs:{size:32,src:t.chatGpt}}),e("span",{staticStyle:{"margin-left":"20px",width:"50%"}},[e("v-md-preview",{attrs:{text:a.content}})],1)],1)])})),0)]):e("div",{staticStyle:{"margin-top":"50px"}},[e("el-empty",{attrs:{description:"暂无对话"}})],1),e("div",{staticClass:"send-card"},[e("el-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"body-style":{padding:"0px"},shadow:"hover"}},[e("el-input",{staticClass:"chat-input",attrs:{autosize:"",maxlength:"100",placeholder:"请输入你的问题"},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}},[e("i",{staticClass:"el-icon-s-promotion el-input__icon",attrs:{slot:"suffix"},on:{click:t.handleSend},slot:"suffix"})])],1)],1)])},s=[],i=a.p+"img/chatgpt.708f3676.png",o=a.p+"img/user.81ef2218.png",c={components:{},name:"chatIndex",data(){return{loading:!1,height:window.innerHeight-180,theme:"light",content:"",contentPre:"",chatDataList:[],chatGpt:i,user:o,url:"https://api.chatanywhere.com.cn/v1/chat/completions",apiKey:"sk-Cg8AqAWoQxhqetjTXfdzOeDm5yKu3zUPdmAg9bweMkxIDskj"}},created(){this.chatDataList=[]},mounted(){document.addEventListener("keyup",this.enterKeyDown)},destroyed(){document.removeEventListener("keyup",this.enterKeyDown)},methods:{enterKeyDown(t){13===t.keyCode&&this.handleSend(),38===t.keyCode&&(this.content=this.contentPre)},reachBottom(){const t=this.$refs.chatRef;t&&setTimeout((()=>{t.scrollTop=t.scrollHeight}),0)},handle2Theme(t){this.theme=t},handleLogOut(){localStorage.removeItem("username"),this.$router.push({path:"/"})},async handleSend(){if(this.loading=!0,!this.content)return this.$message({message:"消息不能为空",type:"warning"}),void(this.loading=!1);const t={role:"user",content:this.content};this.chatDataList.push(t),this.reachBottom();const e={model:"gpt-3.5-turbo",messages:this.chatDataList.slice(-20),stream:!0},a=this,n=await fetch(this.url,{method:"POST",headers:{Authorization:"Bearer "+this.apiKey,"Content-Type":"application/json"},body:JSON.stringify(e)}),s=n.body.pipeThrough(new TextDecoderStream).getReader();let i=!0;do{let{value:t,done:e}=await s.read();if(e&&(i=!1),!t)continue;t=t?.replace("undefined","");const n=t.split("data:");n&&n.length>0&&n.forEach((t=>{if(t&&!t.includes("[DONE]")){let e="";if("\n\n"===t||"\n"===t)e="";else{const a=JSON.parse(t.trim());a.choices&&a.choices.length>0&&a.choices[0].delta.content&&(e=a.choices[0].delta.content)}const n=a.chatDataList[a.chatDataList.length-1];if("assistant"===n.role)a.chatDataList[a.chatDataList.length-1].content=n.content+e;else{const t={role:"assistant",content:e};a.chatDataList.push(t)}a.reachBottom()}}))}while(i);a.contentPre=a.content,a.content="",a.loading=!1}}},l=c,r=a(845),h=(0,r.A)(l,n,s,!1,null,"52fa2808",null),d=h.exports}}]);
//# sourceMappingURL=818.886acf07.js.map